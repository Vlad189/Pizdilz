scripted_gui = {
	TE_post_it_note = {
		window_name = "TE_shield"
        #context_type = selected_country_context
		parent_window_token = top_bar
	}
	
	TE_SelectedPeaceTerms_container_ui = {
		window_name = "TE_selected_terms_window"   
       
		
		visible = {
			check_variable = { ROOT.var_TE_show_peace_gui = 1 }
		}
		
	}



	#### Main variables used for peace process communication
	# VICTOR.var_TE_peace_offer_available@LOSER = 0/1 - unlocks country selection GUI - should be targeted, right? 
	# LOSER.var_TE_has_sent_offer@VICTOR = 0/1 - Conditional peace only - so that you cant sent the same offer twice. 
	# VICTOR.var_TE_has_started_treaty@LOSER = 0/1 - Set to 1 when clicking the button in this GUI 
	# VICTOR.var_TE_has_sent_treaty@LOSER = 0/1 - set to 1 when "DONE" with peace treaty, used to complete mission timer and kick off peace. 
	# VICTOR.var_TE_number_peace_offers_accepted = x # Counter, can be used to show how many peace treaties the player needs to work with
		
		
	TE_PeaceTerms_container_ui = {
		window_name = "TE_peace_terms_window"
        #context_type = selected_country_context 
		
		visible = {
			#has_war_with = ROOT
			# Should only be visible if has targeted Peace approach
			#NOT = {tag = ROOT }
			check_variable = { ROOT.var_TE_show_peace_gui = 1 }
			# also need to check if ongoing resolution of peace... not just if window is open as that will close when finished. Cannot start next until done. 
		}
		
		effects = {
			send_peace_btn_click = {
				# set peace terms sent 
				set_variable = { ROOT.var_TE_has_sent_treaty@var:ROOT.var_TE_target_country = 1 }
				
				# Clear variables used only in this GUI
				var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov@ROOT = 0 } }
				clear_variable = ROOT.current_no_demanded_states
				clear_variable = ROOT.current_no_demanded_states_resources
				clear_variable = ROOT.current_no_demanded_states_demil
				clear_variable = ROOT.current_no_demanded_states_dismatle
				# close this GUI
				set_variable = { ROOT.var_TE_show_peace_gui = 0 }
				TE_clear_peace_term_variables = yes 
			}			
		}
		
		ai_enabled = {
            always = no
		}
		
		ai_test_interval = 100 
        ai_test_variance = 50    
		 
		ai_test_scopes = test_self_country
        
        ai_check = {
			check_variable = { ROOT.var_TE_show_peace_gui = 1 } 
			
        }
        
       
		
		ai_weights = {
			# Go do we want to close window?
			send_peace_btn_click = {
				ai_will_do = {
					factor = 0
					
				}
			}
		}
			
	}
	
	TE_target_country_ui = {
		window_name = "TE_target_country_window"
        context_type = selected_state_context 
		#parent_window_name = TE_peace_terms_window
		parent_window_name = TE_selected_terms_window
		visible = {
			always = yes 
		}

	}
	
	TE_selected_state_window = {
		window_name = "TE_selected_state_window"
        context_type = selected_state_context
		#parent_window_name = TE_peace_terms_window 
		parent_window_name = TE_selected_terms_window 
		visible = {
			always = yes 
		}
		effects = {
			TE_assume_control_btn_click = {
				ROOT = { set_state_controller = PREV }
				add_to_variable = { ROOT.var_TE_ptp_used = 1 }
				subtract_from_variable = { ROOT.var_TE_ptp_available = 1 }
			}
		}
		
		triggers = {
			
			TE_assume_control_btn_click_enabled = {
				ROOT = { 
					OR = {
						is_major = yes 
						is_faction_leader = yes 
					}
				}
				check_variable = { ROOT.var_TE_ptp_available > 0 }
				THIS = {
					OR = { 
						is_owned_by = var:ROOT.var_TE_target_country
						any_country = {
							OR = {
								is_puppet_of = var:ROOT.var_TE_target_country
								is_subject_of = var:ROOT.var_TE_target_country
							}
							PREV = { is_owned_by = PREV }
							
							has_war_with = ROOT 
						}
					}
				}
				any_country = {
					is_in_faction_with = ROOT 
					is_major = no 
					PREV = { 
						is_controlled_by = PREV 
						NOT = { is_core_of = PREV }
						NOT = { is_claimed_by = PREV }
						
					}
					check_variable ={ PREV.var_HE_peace_term_transfer@THIS = 0 }
					
				}
			}
		}

	}
	
	TE_political_terms_window = {
		window_name = "TE_political_terms_window"
        context_type = selected_state_context
		parent_window_name = TE_peace_terms_window  
		visible = {
			always = yes
		}
		effects = {
			TE_Change_Government_btn_click = {  
				IF = { 
					limit = { var:ROOT.var_TE_target_country = { check_variable = { var_TE_change_gov@ROOT = 1 } } } # IF already set -> remove
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov@ROOT = 0 } }
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov = 0 } }
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov_type = 0 } }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_change_gov_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_change_gov_cost }
					ROOT = { add_political_power = 40 }
				}
				ELSE = {
  					var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov@ROOT = 1 } } # IF not set -> Set
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov = ROOT.id } }
					IF = { limit = {  ROOT = { has_government = anarchist } } var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov_type = 1 } } }
					ELSE_IF = { limit = { ROOT = { has_government = democratic } } var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov_type = 2 } } }
					ELSE_IF = { limit = { ROOT = { has_government = communism } } var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov_type = 3 } } }
					ELSE_IF = { limit = { ROOT = { has_government = fascism } } var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov_type = 4 } } }
					ELSE_IF = { limit = { ROOT = { has_government = neutrality } } var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov_type = 5 } } }
					ELSE_IF = { limit = { ROOT = { has_government = monarchist } } var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov_type = 6 } } }
					ELSE_IF = { limit = { ROOT = { has_government = militarist } } var:ROOT.var_TE_target_country = { set_variable = { var_TE_change_gov_type = 7 } } }
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_change_gov_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_change_gov_cost } # subtract cost from available
					ROOT = { add_political_power = -40 }
				}
            }
			
			### Install Puppet
			TE_install_puppet_btn_click = {
				IF = {
					limit = { check_variable = { ROOT.var_TE_inst_pup@var:ROOT.var_TE_target_country = 1 } }
					set_variable = { ROOT.var_TE_inst_pup@var:ROOT.var_TE_target_country = 0 } 
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_inst_pup_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_inst_pup_cost }
					ROOT = {  add_political_power = 25 }
				}
				ELSE = {
					set_variable = { ROOT.var_TE_inst_pup@var:ROOT.var_TE_target_country = 1 } 
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_inst_pup_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_inst_pup_cost }
					ROOT = { add_political_power = -25 }
				}
            }
			### Dissolve - Civil War
			TE_dissolve_btn_click = {
				IF = {
					limit = { check_variable = { ROOT.var_TE_dissolve@var:ROOT.var_TE_target_country = 1 } }
					set_variable { ROOT.var_TE_dissolve@var:ROOT.var_TE_target_country = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_dissolve_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_dissolve_cost }
					ROOT = { add_political_power = 25 }
				}
				ELSE = {
					set_variable { ROOT.var_TE_dissolve@var:ROOT.var_TE_target_country = 1 }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_dissolve_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_dissolve_cost }
					ROOT = { add_political_power = -25 }
				}
			}
			TE_get_recog_btn_click = {
				IF = {
					limit = { check_variable = { ROOT.var_TE_get_recog@var:ROOT.var_TE_target_country = 1 } }
					set_variable = { ROOT.var_TE_get_recog@var:ROOT.var_TE_target_country = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_get_recog_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_get_recog_cost }
					ROOT = { add_political_power = 25 }
				}
				ELSE = {
					set_variable = { ROOT.var_TE_get_recog@var:ROOT.var_TE_target_country = 1 }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_get_recog_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_get_recog_cost }
					ROOT = { add_political_power = -25 }
				}
				
				
			}
			TE_release_pup_btn_click = {
				IF = {
					limit = { THIS.owner = { check_variable = { var_TE_puppet_released = 1 } } }
					THIS.owner = { set_variable = { var_TE_puppet_released = 0 }}
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_release_pup_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_release_pup_cost }
					ROOT = { add_political_power = 10 }
				}
				ELSE = {
					THIS.owner = { set_variable = { var_TE_puppet_released = 1 } }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_release_pup_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_release_pup_cost }
					ROOT = { add_political_power = -10 }
				}
			}
			
			TE_trans_pup_btn_click = {
				IF = {
					limit = { 
						THIS.owner = { check_variable = { var_TE_puppet_transferred = 1 } }
					}
					THIS.owner = { set_variable = { var_TE_puppet_transferred = 0 } }
					ROOT = { set_variable = { var_TE_trans_pup@PREV.owner = 0 } }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_trans_pup_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_trans_pup_cost }
					ROOT = { add_political_power = 15 }
				}
				ELSE = {					
					THIS.owner = { set_variable = { var_TE_puppet_transferred = 1 } }
					THIS.owner = { ROOT = { set_variable = { var_TE_trans_pup@PREV = 1 } } }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_trans_pup_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_trans_pup_cost }
					ROOT = { add_political_power = -15 }
				}
			}
			
			TE_lib_conq_btn_click = {
				IF = {
					limit = { check_variable = { THIS.var_TE_liberate = 1 }}
					THIS = { set_variable = { var_TE_liberate = 0 } }
					clear_variable = THIS.var_TE_liberation_target
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_lib_conq_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_lib_conq_cost }
					ROOT = { add_political_power = 15 }
				}
				ELSE = {
					
					
					# Charge selection GUI
					clear_array = ROOT.my_countries_array
					for_each_scope_loop = {
						array = global.countries
						IF = {
							limit = {
								PREV = {is_core_of = PREV }
								THIS = { exists = no } 
							}
							ROOT = {
								add_to_array = {
									array = ROOT.my_countries_array
									value = PREV
									# index = <index> 
								}
							}
						}
					}

					# Move this to selection GUI when finished 
					IF = { 
						limit = {
							check_variable = { ROOT.my_countries_array^0 > 0 }
						}
					
						set_variable = { THIS.var_TE_liberation_target = ROOT.my_countries_array^0 } # using the first one for now. 
						THIS = { set_variable = { var_TE_liberate = 1 } }
						subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_lib_conq_cost } 
						add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_lib_conq_cost }
						ROOT = { add_political_power = -15 }
					}
					clear_array = ROOT.my_countries_array
					
					
				}
			}
			TE_pup_conq_btn_click = {
				IF = {
					limit = { 
						check_variable = { var_TE_pup_conq = 1 } 
						check_variable = { THIS.var_TE_pup_conq_ovelord = ROOT } 
					}
					THIS = { set_variable = { var_TE_pup_conq = 0 } }
					ROOT = { set_variable = { var_TE_pup_conq_ovelord@PREV = 0 } }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_pup_conq_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_pup_conq_cost }
					clear_variable = THIS.var_TE_pup_conq_target
					clear_variable = THIS.var_TE_pup_conq_ovelord
					ROOT = { add_political_power = 15 }
					
				}
				ELSE = {
					# Charge selection GUI
					clear_array = ROOT.my_countries_array
					for_each_scope_loop = {
						array = global.countries
						IF = {
							limit = {
								PREV = {is_core_of = PREV }
								THIS = { exists = no } 
							}
							ROOT = {
								add_to_array = {
									array = ROOT.my_countries_array
									value = PREV
									# index = <index> 
								}
							}
						}
					}
					# Move this to selection GUI when finished 
					IF = { 
						limit = {
							check_variable = { ROOT.my_countries_array^0 > 0 }
						}
					
						set_variable = { THIS.var_TE_pup_conq_target = ROOT.my_countries_array^0 } # using the first one for now. 
						set_variable = { THIS.var_TE_pup_conq_ovelord = ROOT }
						clear_array = ROOT.my_countries_array
						THIS = { set_variable = { var_TE_pup_conq = 1 } }
						subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_pup_conq_cost } # Repay cost
						add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_pup_conq_cost }
						ROOT = { add_political_power = -15 }
						
					}

				}
				
			}
			
        }
	    triggers = {
			# CHANGE GOVERNMENT
			TE_Change_Government_btn_click_enabled = {
				OR= {
					var:ROOT.var_TE_target_country = { check_variable = { THIS.var_TE_change_gov = 0 }} 	#no-one else has selected this option		
					var:ROOT.var_TE_target_country = { check_variable = { THIS.var_TE_change_gov = ROOT.id } }# I have selected it myself
				}
				TE_change_gov_allowed_ideology = yes
				TE_change_gov_allowed_war_type = yes 
				OR = { 
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_change_gov_cost } } # Can afford
					var:ROOT.var_TE_target_country = { check_variable = { var_TE_change_gov@ROOT = 1 } }
				}
            }
			TE_change_gov_pts_chk_visible = {
				var:ROOT.var_TE_target_country = { check_variable = { THIS.var_TE_change_gov = ROOT.id } }# I have selected it myself
			}
			TE_change_gov_pts_click_enabled = {
				TE_change_gov_allowed_ideology = yes
				TE_change_gov_allowed_war_type = yes 
			}
			
			# INSTALL PUPPET
			TE_install_puppet_btn_click_enabled = {
				TE_inst_pup_allowed_ideology = yes
				TE_inst_pup_allowed_war_type = yes 
				OR = { 
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_inst_pup_cost } } # Can afford
					check_variable = { ROOT.var_TE_inst_pup@var:ROOT.var_TE_target_country = 1 } 
				}
			}
			TE_install_puppet_pts_chk_visible = {
				check_variable = { ROOT.var_TE_inst_pup@var:ROOT.var_TE_target_country = 1 } 
			}
			TE_install_puppet_pts_click_enabled = {
				TE_inst_pup_allowed_ideology = yes
				TE_inst_pup_allowed_war_type = yes 
			}
			
			# DISSOLVE
			TE_dissolve_btn_click_enabled = {
				TE_dissolve_allowed_ideology = yes
				TE_dissolve_allowed_war_type = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_dissolve_cost } } # Can afford
					check_variable = { ROOT.var_TE_dissolve@var:ROOT.var_TE_target_country = 1 }
				}
			}
			TE_dissolve_pts_chk_visible = {
				check_variable = { ROOT.var_TE_dissolve@var:ROOT.var_TE_target_country = 1 }
			}
			TE_dissolve_pts_click_enabled = {
				#TE_dissolve_allowed_ideology = yes
				TE_dissolve_allowed_war_type = yes 
			}
			
			# GET RECOGNITION
			TE_get_recog_btn_click_enabled = {
				TE_get_recog_allowed_ideology = yes
				TE_get_recog_allowed_war_type = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_get_recog_cost } } # Can afford
					check_variable = { ROOT.var_TE_get_recog@var:ROOT.var_TE_target_country = 1 }
				}
			}
			TE_get_recog_pts_chk_visible = {
				check_variable = { ROOT.var_TE_get_recog@var:ROOT.var_TE_target_country = 1 }
			}
			TE_get_recog_pts_click_enabled = {
				TE_get_recog_allowed_ideology = yes
				TE_get_recog_allowed_war_type = yes  
			}
			
			# RELEASE PUPPET
			TE_release_pup_btn_click_enabled = {
				TE_release_pup_allowed_ideology = yes
				TE_release_pup_allowed_war_type = yes 
				any_state = {
					is_owned_by = PREV.owner
					is_capital = yes
					is_controlled_by = ROOT 
				}
				THIS.owner = { 
					OR = {
						is_puppet_of = var:ROOT.var_TE_target_country
						is_subject_of = var:ROOT.var_TE_target_country
					}
				}
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_release_pup_cost } } # Can afford
					THIS.owner = { check_variable = { var_TE_puppet_released = 1 } } # already selected - must be allowed to deselect
				}
			}
			TE_release_pup_pts_chk_visible = {
				THIS.owner = { check_variable = { var_TE_puppet_released = 1 } } 
			}
			TE_release_pup_pts_click_enabled = {
				TE_release_pup_allowed_ideology = yes
				TE_release_pup_allowed_war_type = yes  
			}
			
			# TRANFER PUPPET
			TE_trans_pup_btn_click_enabled = {
				TE_trans_pup_allowed_ideology = yes
				TE_trans_pup_allowed_war_type = yes 
				any_state = {
					is_owned_by = PREV.owner
					# is_capital = yes
					is_controlled_by = ROOT 
				}
				THIS.owner = { 
					OR = {
						is_puppet_of = var:ROOT.var_TE_target_country
						is_subject_of = var:ROOT.var_TE_target_country
					}
				}
				# check that noone else has set it already 
				
				NOT = {
					check_variable = { THIS.var_TE_puppet_transferred = 1 }
				#	check_variable = { ROOT.var_TE_trans_pup@THIS = 0 }
				}
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_trans_pup_cost } } # Can afford
					THIS.owner = { check_variable = { var_TE_puppet_transferred = 1 } } # already selected - must be allowed to deselect
				}
			}
			TE_trans_pup_pts_chk_visible = {
				THIS.owner = { check_variable = { var_TE_puppet_transferred = 1 } } 
			}
			TE_trans_pup_pts_click_enabled = {
				TE_trans_pup_allowed_ideology = yes
				TE_trans_pup_allowed_war_type = yes  
			}
			
			TE_lib_conq_btn_click_enabled = {
				TE_lib_conq_allowed_ideology = yes 
				TE_lib_conq_allowed_war_type = yes 
				THIS = { is_owned_by = var:ROOT.var_TE_target_country }
				#THIS = { NOT = { is_core_of = var:ROOT.var_TE_target_country } }  ###  USE if causesing too much confusion otherwise...
				THIS = { is_controlled_by = ROOT } # you can only do it if you control the state	
				check_variable = { THIS.var_TE_pup_conq = 0 } # you can't liberate if you've already said you will puppet
				check_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 } # you can't liberate if you are conquering...
				
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_lib_conq_cost } } # Can afford
					 check_variable = { THIS.var_TE_liberate = 1 } # Already selected 
				}
			}
			TE_lib_conq_pts_chk_visible = {
				check_variable = { THIS.var_TE_liberation_target > 0 } 
			}
			TE_lib_conq_pts_click_enabled = {
				TE_lib_conq_allowed_ideology = yes
				TE_lib_conq_allowed_war_type = yes 
			}
			
			TE_pup_conq_btn_click_enabled = {
				TE_pup_conq_allowed_ideology = yes
				TE_pup_conq_allowed_war_type = yes 
				THIS = { is_owned_by = var:ROOT.var_TE_target_country }
				THIS = { is_controlled_by = ROOT }
				check_variable = { THIS.var_TE_liberate = 0 }
				check_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_pup_conq_cost } } # Can afford
					check_variable = { THIS.var_TE_pup_conq_ovelord = ROOT } 
				}
			}
			TE_pup_conq_pts_chk_visible = {
				check_variable = { var_TE_pup_conq = 1 } 
			}
			TE_pup_conq_pts_click_enabled = {
				TE_pup_conq_allowed_ideology = yes
				TE_pup_conq_allowed_war_type = yes 
			}
        }
	}
	
	TE_conquered_countries_ui = {
		window_name = "TE_conquered_countries_window"
        context_type = selected_state_context
		parent_window_name = TE_peace_terms_window
		visible = {
			always = yes 
		}
		
		effects = {
			
		}
		
		
		
		triggers = {
			
		}
	}
	
	
	
	TE_territorial_terms_window = {
		window_name = "TE_territorial_terms_window"
        context_type = selected_state_context
		parent_window_name = TE_peace_terms_window
		visible = {
			# THIS.OWNER = { has_war_with = ROOT } #should be change to "has peace talks with" - or possibly not even needed...
		}
		#TE_take_core_btn
		effects = {
            
			## ANNEX STATES
			TE_annex_btn_click = { 
				IF = {
					limit = { check_variable ={ ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 1 } } # check if already selected 
					set_variable = {  ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_annex_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_annex_cost }
					every_state = {
						limit = {
							OR = { 
								is_owned_by = var:ROOT.var_TE_target_country
								any_country = {
									PREV = { is_owned_by = PREV }
									OR = {
										is_puppet_of = var:ROOT.var_TE_target_country
										is_subject_of = var:ROOT.var_TE_target_country
									}
									has_war_with = ROOT 
								}
							}
							#is_controlled_by = ROOT
							check_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
						}
						set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
						subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					}
					ROOT = { add_political_power = 50}
				}
				ELSE = {
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_annex_cost }
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_annex_cost }
					set_variable = {  ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 1 }
					every_state = {
						limit = {
							OR = { 
								is_owned_by = var:ROOT.var_TE_target_country
								any_country = {
									PREV = { is_owned_by = PREV }
									OR = {
										is_puppet_of = var:ROOT.var_TE_target_country
										is_subject_of = var:ROOT.var_TE_target_country
									}
									has_war_with = ROOT 
								}
							}
							is_controlled_by = ROOT
							#check_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
						}
						set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
						add_to_variable = { ROOT.current_no_demanded_states = 1 }
					}
					ROOT = { add_political_power = -50}
				}
            }
			
			### TAKE CORE
			TE_take_core_btn_click = { 
				IF = {
					limit = { check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } } # check if already selected 
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_core_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_core_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = 2}
				}
				ELSE = {
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_core_cost }
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_core_cost }
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
					add_to_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = -2}
				}
            }
			
			# TAKE CLAIMED
			TE_take_claimed_btn_click = { 
				IF = {
					limit = { check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } } # check if already selected 
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_claimed_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_claimed_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = 5}
				}
				ELSE = {
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_claimed_cost } # subtract from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_claimed_cost } # add to used
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
					add_to_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = -5}
				}
				
            }
			
			# TAKE BORDER STATE
			TE_take_border_state_btn_click = { 
				IF = {
					limit = { check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } } # check if already selected 
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_border_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_border_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = 8}
				}
				ELSE = {
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_border_cost } # subtract from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_border_cost } # add to used
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
					add_to_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = -8}
				}
				
            }
			
			# TAKE OTHER STATE 
			TE_take_other_btn_click = { 
				IF = {
					limit = { check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } } # check if already selected 
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_other_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_other_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = 10}
				}
				ELSE = {
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_other_cost } # subtract from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_other_cost } # add to used
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
					add_to_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = -10}
				}
				
            }
			
			# TAKE PORT STATE
			TE_take_port_btn_click = { 
				IF = {
					limit = { check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } } # check if already selected 
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_port_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_port_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = 10}
				}
				ELSE = {
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_port_cost } # subtract from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_port_cost } # add to used
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
					add_to_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = -10}
				}
				
            }
			
			# TAKE ISLAND
			TE_take_island_btn_click = { 
				IF = {
					limit = { check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } } # check if already selected 
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_island_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_island_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = 6}
				}
				ELSE = {
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_island_cost } # subtract from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_island_cost } # add to used
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
					subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = -6}
				}
				
            }
			
			# TAKE COLONY
			TE_take_colony_btn_click = { 
				IF = {
					limit = { check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } } # check if already selected 
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_colony_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_colony_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = 6}
				}
				ELSE = {
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_take_colony_cost } # subtract from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_take_colony_cost } # add to used
					set_variable = { THIS.var_HE_peace_term_transfer@ROOT = 1 }
					add_to_variable = { ROOT.current_no_demanded_states = 1 }
					ROOT = { add_political_power = -6}
				}
				
            }
			
			# GIVE TO ALLY
			TE_give_to_ally_btn_click = {
				IF = {
					limit = { check_variable = { THIS.give_to_ally_FROM = ROOT.id } }
					THIS = { clear_variable = give_to_ally_FROM  }
					
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_give_to_ally_cost }
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_give_to_ally_cost }
					ROOT = { add_political_power = 10}
				}
				ELSE = {
					set_variable = { THIS.give_to_ally_FROM = ROOT.id }
					random_country = {
						limit = {
							NOT = { tag = ROOT }
							NOT = { tag = var:ROOT.var_TE_target_country }
							OR = {
								is_in_faction_with = ROOT
								is_subject_of = ROOT
								is_puppet_of = ROOT 
								ROOT = { is_puppet_of = PREV }
								ROOT = { is_subject_of = PREV }
							}
							has_war_with = var:ROOT.var_TE_target_country
							OR = {
								PREV = { is_claimed_by = PREV }
								PREV = { is_core_of = PREV }
								PREV = { any_neighbor_state = { is_owned_by = PREV.PREV } }
							}
							
						}
						set_variable = { PREV.var_HE_peace_term_transfer@THIS = 1 }
					}
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_give_to_ally_cost } # add to used
					subtract_from_variable = ROOT.var_TE_ptp_available = ROOT.var_TE_give_to_ally_cost }
					ROOT = { add_political_power = -10}
				}
			}
		}
		triggers = {
           TE_annex_btn_click_enabled = {
				TE_annex_allowed_ideology = yes
				TE_annex_allowed_war_type = yes 
				check_variable = { ROOT.var_TE_inst_pup@var:ROOT.var_TE_target_country = 0 } 
				OR = { 	
					check_variable ={ ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 1 } 
					NOT = { 
						any_state = { 
							OR = { 
								is_owned_by = var:ROOT.var_TE_target_country
								any_country = {
									PREV = { is_owned_by = PREV }
									OR = {
										is_puppet_of = var:ROOT.var_TE_target_country
										is_subject_of = var:ROOT.var_TE_target_country
									}
									has_war_with = ROOT 
								}
							}
							
							check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
								
							
						}
					}
				}
				any_state = {
					OR = { 
						is_owned_by = var:ROOT.var_TE_target_country
						any_country = {
							PREV = { is_owned_by = PREV }
							OR = {
								is_puppet_of = var:ROOT.var_TE_target_country
								is_subject_of = var:ROOT.var_TE_target_country
							}
							has_war_with = ROOT 
						}
					}
					is_controlled_by = ROOT
				}
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_annex_cost } } # Can afford
					check_variable ={ ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 1 } # already selected - must be allowed to deselect
				}
				
			}
			TE_annex_pts_chk_visible = {
				check_variable ={ ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 1 } 
			}
			TE_annex_pts_click_enabled = {
				TE_annex_allowed_ideology = yes
				TE_annex_allowed_war_type = yes 
			}
			 
			 
			TE_take_core_btn_click_enabled = {
				TE_take_core_allowed_ideology = yes
				TE_take_core_allowed_war_type = yes 
				check_variable ={ ROOT.var_TE_annex@var:var_TE_target_country = 0 } # Not selected as per Annex
				TE_is_selectable_core_state = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_take_core_cost } } # Can afford
					check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } # already selected - must be allowed to deselect
				}
			}
			TE_take_core_pts_chk_visible = {
				check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
				TE_is_selectable_core_state = yes 
			}
			TE_take_core_pts_click_enabled = {
				TE_take_core_allowed_ideology = yes
				TE_take_core_allowed_war_type = yes 
			}
				
			TE_take_claimed_btn_click_enabled = {
				TE_take_claimed_allowed_ideology = yes
				TE_take_claimed_allowed_war_type = yes 
				check_variable ={ ROOT.var_TE_annex@var:var_TE_target_country = 0 } 
				TE_is_selectable_claimed_state = yes
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_take_claimed_cost } } # Can afford
					check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_take_claimed_pts_chk_visible = {
				check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
				TE_is_selectable_claimed_state = yes 
			}
			TE_take_claimed_pts_click_enabled = {
				TE_take_claimed_allowed_ideology = yes
				TE_take_claimed_allowed_war_type = yes 
			}
			
			
			
			TE_take_border_state_btn_click_enabled = {
				TE_take_border_allowed_ideology = yes
				TE_take_border_allowed_war_type = yes 
				check_variable ={ ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 0 } 
				TE_is_selectable_border_state = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_take_border_cost } } # Can afford
					check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_take_border_pts_click_enabled = {
				TE_take_border_allowed_ideology = yes
				TE_take_border_allowed_war_type = yes 
			}
			
			TE_take_border_pts_chk_visible = {
				check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
				TE_is_selectable_border_state = yes
			}
			
			TE_take_other_btn_click_enabled = {
				TE_take_other_allowed_ideology = yes
				TE_take_other_allowed_war_type = yes 
				check_variable ={ ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 0 } 
				TE_is_selectable_other_state = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_take_other_cost } } # Can afford
					check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_take_other_pts_click_enabled = {
				TE_take_other_allowed_ideology = yes
				TE_take_other_allowed_war_type = yes 
			}
			
			TE_take_other_pts_chk_visible = {
				check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
				TE_is_selectable_other_state = yes
			}
			
			TE_take_port_btn_click_enabled = {
				TE_take_port_allowed_ideology = yes
				TE_take_port_allowed_war_type = yes 
				check_variable ={ ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 0 } 
				TE_is_selectable_port_state = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_take_port_cost } } # Can afford
					check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_take_port_pts_chk_visible = {
				check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
				TE_is_selectable_port_state = yes 
			} 
			TE_take_port_pts_click_enabled = {
				TE_take_port_allowed_ideology = yes
				TE_take_port_allowed_war_type = yes 
			}
			
			TE_take_island_btn_click_enabled = {
				TE_take_island_allowed_ideology = yes
				TE_take_island_allowed_war_type = yes 
				check_variable ={ ROOT.var_TE_annex@var:var_TE_target_country = 0 } 
				TE_is_selectable_island_state = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_take_island_cost } } # Can afford
					check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_take_island_pts_chk_visible = {
				check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
				TE_is_selectable_island_state = yes 
			}
			TE_take_island_pts_click_enabled = {
				TE_take_island_allowed_ideology = yes
				TE_take_island_allowed_war_type = yes 
			}
			
			TE_take_colony_btn_click_enabled = {
				TE_take_colony_allowed_ideology = yes
				TE_take_colony_allowed_war_type = yes 
				check_variable ={ ROOT.var_TE_annex@var:var_TE_target_country = 0 } 
				TE_is_selectable_colony_state = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_take_colony_cost } } # Can afford
					check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_take_colony_pts_chk_visible = {
				check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
				TE_is_selectable_colony_state = yes 
			}
			TE_take_colony_pts_click_enabled = {
				TE_take_colony_allowed_ideology = yes
				TE_take_colony_allowed_war_type = yes 
			}
			TE_give_to_ally_btn_click_enabled = {
				TE_give_to_ally_allowed_ideology = yes
				TE_give_to_ally_allowed_war_type = yes
				check_variable ={ ROOT.var_TE_annex@var:var_TE_target_country = 0 } 
				THIS = { is_controlled_by = ROOT }
				any_country = {
					NOT = { tag = ROOT }
					NOT = { tag = var:ROOT.var_TE_target_country }
					OR = {
						is_in_faction_with = ROOT
						is_subject_of = ROOT
						is_puppet_of = ROOT 
						ROOT = { is_puppet_of = PREV }
						ROOT = { is_subject_of = PREV }
					}
					has_war_with = var:ROOT.var_TE_target_country
					OR = {
						PREV = { is_claimed_by = PREV }
						PREV = { is_core_of = PREV }
						PREV = { any_neighbor_state = { is_owned_by = PREV.PREV } }
					}
				}
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_give_to_ally_cost } } # Can afford
					check_variable = { THIS.give_to_ally_FROM = ROOT.id }  # already selected - must be allowed to deselect
				}
			}
			TE_give_to_ally_pts_chk_visible = {
				check_variable = { THIS.give_to_ally_FROM = ROOT.id } 
			}
			TE_give_to_ally_pts_click_enabled = {
				TE_give_to_ally_allowed_ideology = yes
				TE_give_to_ally_allowed_war_type = yes
			}
		}
		
		ai_enabled = {
            always = no
		}
		#ai_test_parent = "TE_peace_terms_window"
		ai_test_interval = 50
        ai_test_variance = 25  
		 
		ai_test_scopes = test_enemy_owned_states
        ai_max_weight_taken_per_test = 1
        ai_check = {
			check_variable = { ROOT.var_TE_show_peace_gui = 1 } 
			
        }
        
       
		
		ai_weights = {
			
			TE_take_claimed_btn_click = {
				ai_will_do = {
					factor = 0.4
					modifier = {
						factor = 0
						check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
					}
				}
			}
			TE_take_border_state_btn_click = {
				ai_will_do = {
					factor = 1
					modifier = {
						factor = 0
						check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }
					}
				}
			}
		}
		
		
	}
	
	TE_financial_industrial_terms_window = {
		window_name = "TE_financial_industrial_terms_window"
        context_type = selected_state_context 
		parent_window_name = TE_peace_terms_window
		visible = {
			always = yes
		}
		effects = { 
			TE_war_rep_btn_click = {  
				IF = {
					limit = { check_variable = { ROOT.var_TE_get_war_rep@var:ROOT.var_TE_target_country = 1 } }
					set_variable = { ROOT.var_TE_get_war_rep@var:ROOT.var_TE_target_country = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_war_rep_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_war_rep_cost }
					ROOT = { add_political_power = 5}
				}
				ELSE = {
					set_variable = { ROOT.var_TE_get_war_rep@var:ROOT.var_TE_target_country = 1 }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_war_rep_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_war_rep_cost }
					ROOT = { add_political_power = -5}
				}
			}
			
			TE_oil_rights_btn_click = {
				IF = {
					limit = { check_variable = { THIS.var_TE_oil_rights_demanded@ROOT = 1 } }
					set_variable = { THIS.var_TE_oil_rights_demanded@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_oil_rights_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_oil_rights_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states_resources = 1 }
					ROOT = { add_political_power = 15}
				}
				ELSE = {
					set_variable = { THIS.var_TE_oil_rights_demanded@ROOT = 1  }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_oil_rights_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_oil_rights_cost }
					add_to_variable = { ROOT.current_no_demanded_states_resources = 1 }
					ROOT = { add_political_power = -15}
				}
			}
			
			TE_reduce_mil_btn_click = {
				IF = {
					limit = { check_variable = { ROOT.var_TE_reduce_mil@var:ROOT.var_TE_target_country = 1 } }
					set_variable = { ROOT.var_TE_reduce_mil@var:ROOT.var_TE_target_country = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_reduce_mil_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_reduce_mil_cost }
					ROOT = { add_political_power = 25}
				}
				ELSE = {
					set_variable = { ROOT.var_TE_reduce_mil@var:ROOT.var_TE_target_country = 1  }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_reduce_mil_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_reduce_mil_cost }
					ROOT = { add_political_power = -25}
				}
			}
			
		}
		triggers = {
			# War reparations
			TE_war_rep_btn_click_enabled = {
				TE_war_rep_allowed_ideology = yes
				TE_war_rep_allowed_war_type = yes
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_war_rep_cost } } # Can afford
					check_variable = { ROOT.var_TE_get_war_rep@var:ROOT.var_TE_target_country = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_war_rep_pts_chk_visible = {
				check_variable = { ROOT.var_TE_get_war_rep@var:ROOT.var_TE_target_country = 1 }
			}
			TE_war_rep_pts_click_enabled = {
				TE_war_rep_allowed_ideology = yes
				TE_war_rep_allowed_war_type = yes 
			}
			
			# Oil rights
			TE_oil_rights_btn_click_enabled = {
				TE_oil_rights_allowed_ideology = yes
				TE_oil_rights_allowed_war_type = yes 
				check_variable = { THIS.resource@oil > 0 } 
				THIS = {
					OR = { 
						is_owned_by = var:ROOT.var_TE_target_country
						any_country = {
							PREV = { is_owned_by = PREV }
							NOT = { PREV = { is_core_of = PREV } }
							OR = {
								is_puppet_of = var:ROOT.var_TE_target_country
								is_subject_of = var:ROOT.var_TE_target_country
							}
							has_war_with = ROOT 
						}
					}
					is_controlled_by = ROOT
				}
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_oil_rights_cost } } # Can afford
					check_variable = { THIS.var_TE_oil_rights_demanded@ROOT = 1 } # already selected - must be allowed to deselect
				}
				check_variable = { THIS.var_HE_peace_term_transfer@ROOT = 0 } # no point demanding rights if you have already decided to take the state
            }
			TE_oil_rights_pts_chk_visible = {
				check_variable = { THIS.var_TE_oil_rights_demanded@ROOT = 1 } 
			}
			TE_oil_rights_pts_click_enabled = {
				TE_oil_rights_allowed_ideology = yes
				TE_oil_rights_allowed_war_type = yes 
			}
			
			# Reduce Military
			TE_reduce_mil_btn_click_enabled = {
				TE_reduce_mil_allowed_ideology = yes
				TE_reduce_mil_allowed_war_type = yes 
				var:var_TE_target_country = { arms_factory > 0 } 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_reduce_mil_cost } } # Can afford
					check_variable = { ROOT.var_TE_reduce_mil@var:ROOT.var_TE_target_country = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_reduce_mil_pts_chk_visible = {
				check_variable = { ROOT.var_TE_reduce_mil@var:ROOT.var_TE_target_country = 1 }
			}
			TE_reduce_mil_pts_click_enabled = {
				TE_reduce_mil_allowed_ideology = yes
				TE_reduce_mil_allowed_war_type = yes 
			}
		}
	}
	
	TE_naval_terms_window = {
		window_name = "TE_naval_terms_window"
        context_type = selected_country_context
		parent_window_name = TE_peace_terms_window
		visible = {
			always = yes
		}
		
		effects = {
			# Reduce Naval Capacity
			TE_reduce_naval_btn_click = {
				IF = {
					limit = { check_variable = { ROOT.var_TE_reduce_naval@var:ROOT.var_TE_target_country = 1 } }
					set_variable = { ROOT.var_TE_reduce_naval@var:ROOT.var_TE_target_country = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_reduce_naval_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_reduce_naval_cost }
					ROOT = { add_political_power = 25}
				}
				ELSE = {
					set_variable = { ROOT.var_TE_reduce_naval@var:ROOT.var_TE_target_country = 1  }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_reduce_naval_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_reduce_naval_cost }
					ROOT = { add_political_power = -25}
				}
			}
			# Reduce Navy
			TE_reduce_navy_btn_click = {
				IF = {
					limit = { check_variable = { ROOT.var_TE_destroy_navy@var:ROOT.var_TE_target_country = 1 } }
					set_variable = { ROOT.var_TE_destroy_navy@var:ROOT.var_TE_target_country = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_reduce_navy_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_reduce_navy_cost }
					ROOT = { add_political_power = 25 }
				}
				ELSE = {
					set_variable = { ROOT.var_TE_destroy_navy@var:ROOT.var_TE_target_country = 1  }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_reduce_navy_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_reduce_navy_cost }
					ROOT = { add_political_power = -25}
				}
			}
			# Transfer Navy
			TE_transfer_navy_btn_click = {
				IF = {
					limit = { check_variable = { ROOT.var_TE_transfer_navy@var:ROOT.var_TE_target_country = 1 } }
					clear_variable = ROOT.var_TE_transfer_navy@var:ROOT.var_TE_target_country
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_transfer_navy_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_transfer_navy_cost }
					ROOT = { add_political_power = 150 }
				}
				ELSE = {
					set_variable = { ROOT.var_TE_transfer_navy@var:ROOT.var_TE_target_country = 1  }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_transfer_navy_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_transfer_navy_cost }
					ROOT = { add_political_power = -150 }
				}
			}
		}
		
		triggers = {
			# Reduce NAVAL CAPACITY
			TE_reduce_naval_btn_click_enabled = {
				TE_reduce_naval_allowed_ideology = yes
				TE_reduce_naval_allowed_war_type = yes 
				var:ROOT.var_TE_target_country = { dockyard > 0 } 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_reduce_naval_cost } } # Can afford
					check_variable = { ROOT.var_TE_reduce_naval@var:ROOT.var_TE_target_country = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_reduce_naval_pts_chk_visible = {
				check_variable = { ROOT.var_TE_reduce_naval@var:ROOT.var_TE_target_country = 1 } 
			}
			TE_reduce_naval_pts_click_enabled = {
				TE_reduce_naval_allowed_ideology = yes
				TE_reduce_naval_allowed_war_type = yes 
			}
			# Reduce Navy
			TE_reduce_navy_btn_click_enabled = {
				TE_reduce_navy_allowed_ideology = yes
				TE_reduce_navy_allowed_war_type = yes 
				var:ROOT.var_TE_target_country = { has_navy_size = { size > 1 } }
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_reduce_navy_cost } } # Can afford
					check_variable = { ROOT.var_TE_destroy_navy@var:ROOT.var_TE_target_country = 1 } # already selected - must be allowed to deselect
				}
            }
			TE_reduce_navy_pts_chk_visible = {
				check_variable = { ROOT.var_TE_destroy_navy@var:ROOT.var_TE_target_country = 1 }
			}
			TE_reduce_navy_pts_click_enabled = {
				TE_reduce_navy_allowed_ideology = yes
				TE_reduce_navy_allowed_war_type = yes 
			}
			# Transfer Navy
			TE_transfer_navy_btn_click_enabled = {
				TE_transfer_navy_allowed_ideology = yes
				TE_transfer_navy_allowed_war_type = yes 
				var:ROOT.var_TE_target_country = { has_navy_size = { size > 0 } }
				
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_transfer_navy_cost } } # Can afford
					check_variable = { ROOT.var_TE_transfer_navy@var:ROOT.var_TE_target_country = 1 } # already selected - must be allowed to deselect
				}
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						check_variable = { THIS.var_TE_transfer_navy@var:ROOT.var_TE_target_country = 1 }
					}
				}
            }
			TE_transfer_navy_pts_chk_visible = {
				check_variable = { ROOT.var_TE_transfer_navy@var:ROOT.var_TE_target_country = 1 }
			}
			TE_transfer_navy_pts_click_enabled = {
				TE_transfer_navy_allowed_ideology = yes
				TE_transfer_navy_allowed_war_type = yes 
			}
		}
	}
	TE_security_terms_window = {
		window_name = "TE_security_terms_window"
        context_type = selected_state_context
		parent_window_name = TE_peace_terms_window
		visible = {
			always = yes
		}
		effects = {
			TE_set_demil_btn_click = {
				IF = {
					limit = { check_variable = { THIS.var_TE_set_demil@ROOT = 1 } }
					set_variable = { THIS.var_TE_set_demil@ROOT = 0 }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_set_demil_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_set_demil_cost }
					subtract_from_variable = { ROOT.current_no_demanded_states_demil = 1 }
					ROOT = { add_political_power = 10}
				}
				ELSE = {
					set_variable = { THIS.var_TE_set_demil@ROOT = 1  }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_set_demil_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_set_demil_cost }
					add_to_variable = { ROOT.current_no_demanded_states_demil = 1 }
					ROOT = { add_political_power = -10}
				}
			}
			TE_limit_military_btn_click = {
				IF = {
					limit = { var:ROOT.var_TE_target_country = { check_variable = { var_TE_limit_military@ROOT = 1  } } }
					var:ROOT.var_TE_target_country = { clear_variable = var_TE_limit_military@ROOT }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_limit_military_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_limit_military_cost }
					ROOT = { add_political_power = 10}
				}
				ELSE = {
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_limit_military@ROOT = 1 } }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_limit_military_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_limit_military_cost }
					ROOT = { add_political_power = -10}
				}
			}
			
		}
		triggers = {
			TE_set_demil_btn_click_enabled = {
				TE_set_demil_allowed_ideology = yes
				TE_set_demil_allowed_war_type = yes 
				check_variable ={ ROOT.var_TE_annex@var:ROOT.var_TE_target_country = 0 } 
				THIS = { 
					OR = {
						any_neighbor_state = { is_owned_by = ROOT }
						any_country = {
							is_in_faction_with = ROOT 
							PREV = { any_neighbor_state = { is_owned_by = PREV } }
						}
					}
								
					OR = { 
						is_owned_by = var:ROOT.var_TE_target_country
						any_country = {
							PREV = { is_owned_by = PREV }
							OR = {
								is_puppet_of = var:ROOT.var_TE_target_country
								is_subject_of = var:ROOT.var_TE_target_country
							}
							has_war_with = ROOT 
						}
					}
					is_controlled_by = ROOT
				}
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_set_demil_cost } } # Can afford
					check_variable = { THIS.var_TE_set_demil@ROOT = 1 } # already selected - must be allowed to deselect
				}
				NOT = { check_variable ={ THIS.var_HE_peace_term_transfer@ROOT = 1 }  }
			}
			TE_set_demil_pts_chk_visible = {
				check_variable = { THIS.var_TE_set_demil@ROOT = 1 }
			}
			TE_set_demil_pts_click_enabled = {
				TE_set_demil_allowed_ideology = yes
				TE_set_demil_allowed_war_type = yes
			}
			
			
			# Limit Military 
			TE_limit_military_btn_click_enabled = {
				TE_limit_military_allowed_ideology = yes
				TE_limit_military_allowed_war_type = yes 
				
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_limit_military_cost } } # Can afford
					var:ROOT.var_TE_target_country = { check_variable = { var_TE_limit_military@ROOT = 1 } } # already selected - must be allowed to deselect
				}
            }
			TE_limit_military_pts_chk_visible = {
				var:ROOT.var_TE_target_country = { check_variable = { var_TE_limit_military@ROOT = 1 } }
			}
			TE_limit_military_pts_click_enabled = {
				TE_limit_military_allowed_ideology = yes
				TE_limit_military_allowed_war_type = yes 
			}
		}
		
	}
	TE_diplomatic_terms_window = {
		window_name = "TE_diplomatic_terms_window"
        context_type = selected_state_context
		parent_window_name = TE_peace_terms_window
		visible = {
			always = yes
		}
		effects = {
			TE_revoke_core_btn_click = {
				IF = {
					limit = { var:ROOT.var_TE_target_country = { check_variable = { var_TE_revoke_core@PREV = 1 } } }
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_revoke_core@PREV = 0 } }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_revoke_core_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_revoke_core_cost }
					subtract_from_variable = { ROOT.current_no_revoked_core_states = 1 }
					ROOT = { add_political_power = 5}
				}
				ELSE = {
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_revoke_core@PREV = 1  } }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_revoke_core_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_revoke_core_cost }
					add_to_variable = { ROOT.current_no_revoked_core_states = 1 }
					ROOT = { add_political_power = -5}
				}
			}
			TE_revoke_claim_btn_click = {
				IF = {
					limit = { var:ROOT.var_TE_target_country = { check_variable = { var_TE_revoke_claim@PREV = 1 } } }
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_revoke_claim@PREV = 0 } }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_revoke_claim_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_revoke_claim_cost }
					subtract_from_variable = { ROOT.current_no_revoked_claimed_states = 1 }
					ROOT = { add_political_power = 2}
				}
				ELSE = {
					var:ROOT.var_TE_target_country = { set_variable = { var_TE_revoke_claim@PREV = 1  } }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_revoke_claim_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_revoke_claim_cost }
					add_to_variable = { ROOT.current_no_revoked_claimed_states = 1 }
					ROOT = { add_political_power = -2}
				}
			}
			TE_return_core_btn_click = { # THIS = { check_variable = { var_TE_return_core@ROOT = 1 } }
				IF = {
					limit = { THIS = { check_variable = { var_TE_return_core@ROOT = 1 } } }
					THIS = { set_variable = { var_TE_return_core@ROOT = 0 } }
					add_to_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_return_core_cost } # Repay cost
					subtract_from_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_return_core_cost }
					ROOT = { add_political_power = 5}
					subtract_from_variable = { ROOT.current_no_return_core_states = 1 }
				}
				ELSE = {
					THIS = { set_variable = { var_TE_return_core@ROOT = 1 } }
					subtract_from_variable = { ROOT.var_TE_ptp_available = ROOT.var_TE_return_core_cost } # subtract cost from available
					add_to_variable = { ROOT.var_TE_ptp_used = ROOT.var_TE_return_core_cost }
					ROOT = { add_political_power = -5}
					# todo: make better gui...
					random_country = {
						limit = {
							PREV = { is_core_of = PREV }
							NOT = { tag = ROOT }
							NOT = { tag = var:ROOT.var_TE_target_country }
						}
						set_variable = { PREV.var_TE_return_core_country = THIS } 
						Log = "return to [THIS.GetName] "
					}
					add_to_variable = { ROOT.current_no_return_core_states = 1 }
					
				}
			}
		}
		triggers = {
			# REVOKE CORE
			TE_revoke_core_btn_click_enabled = {
				TE_revoke_core_allowed_ideology = yes
				TE_revoke_core_allowed_war_type = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_revoke_core_cost } } # Can afford
					var:ROOT.var_TE_target_country = { check_variable = { var_TE_revoke_core@PREV = 1 } }# already selected - must be allowed to deselect
				}
				
				var:ROOT.var_TE_target_country = { PREV = { is_core_of = PREV  } }
				THIS = { is_owned_by = ROOT }
				
            }
			TE_revoke_core_pts_chk_visible = {
				var:ROOT.var_TE_target_country = { check_variable = { var_TE_revoke_core@PREV = 1 } }
			}
			TE_revoke_core_pts_click_enabled = {
				TE_revoke_core_allowed_ideology = yes
				TE_revoke_core_allowed_war_type = yes 
			}
			# REVOKE CLAIM
			TE_revoke_claim_btn_click_enabled = {
				TE_revoke_claim_allowed_ideology = yes
				TE_revoke_claim_allowed_war_type = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_revoke_claim_cost } } # Can afford
					var:ROOT.var_TE_target_country = { check_variable = { var_TE_revoke_claim@PREV = 1 } }# already selected - must be allowed to deselect
				}
				
				var:ROOT.var_TE_target_country = { PREV = { is_claimed_by = PREV  } }
				THIS = { is_owned_by = ROOT }
				
            }
			TE_revoke_claim_pts_chk_visible = {
				var:ROOT.var_TE_target_country = { check_variable = { var_TE_revoke_claim@PREV = 1 } }
			}
			TE_revoke_claim_pts_click_enabled = {
				TE_revoke_claim_allowed_ideology = yes
				TE_revoke_claim_allowed_war_type = yes 
			}
			
			# RETURN CORE
			TE_return_core_btn_click_enabled = {
				TE_return_core_allowed_ideology = yes
				TE_return_core_allowed_war_type = yes 
				OR = {
					NOT = { check_variable { ROOT.var_TE_ptp_available < ROOT.var_TE_return_core_cost } } # Can afford
					THIS = { check_variable = { var_TE_return_core@ROOT = 1 } }# already selected - must be allowed to deselect
				}
				
				# Conditions here
				THIS = { 
					is_owned_by = var:ROOT.var_TE_target_country 
					any_country = {
						NOT = { tag = var:ROOT.var_TE_target_country }
						NOT = { tag = ROOT }
						PREV = { 
							is_core_of = PREV 
							OR = {
								any_neighbor_state = { is_owned_by = PREV.PREV }
								is_island_state = yes 
							}
						}
					
					}
					OR = {
						is_controlled_by = ROOT 
						is_controlled_by = var:ROOT.var_TE_target_country 
					}
				}
				
				#
				
            }
			TE_return_core_pts_chk_visible = {
				var:ROOT.var_TE_target_country = { check_variable = { var_TE_return_core@PREV = 1 } }
			}
			TE_return_core_pts_click_enabled = {
				TE_return_core_allowed_ideology = yes
				TE_return_core_allowed_war_type = yes 
			}
		}
	}
	
}